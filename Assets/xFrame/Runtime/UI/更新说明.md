# UIç»„ä»¶ç³»ç»Ÿæ›´æ–°è¯´æ˜

## ğŸ‰ v2.1 - ç³»ç»Ÿä¼˜åŒ–ä¸å¢å¼º (2024-12-04)

### Bugä¿®å¤
- âœ… ä¿®å¤ `UITabContainer.OnUIDestroy()` ä¸­é”™è¯¯è°ƒç”¨ `OnDestroy()` çš„é—®é¢˜ï¼Œæ”¹ä¸ºæ­£ç¡®è°ƒç”¨ `base.OnUIDestroy()`

### æ–°åŠŸèƒ½

#### 1. UIäº‹ä»¶é€šçŸ¥ç³»ç»Ÿ
UIManagerç°åœ¨ä¼šåœ¨UIæ‰“å¼€/å…³é—­æ—¶è‡ªåŠ¨å‘é€äº‹ä»¶é€šçŸ¥ï¼š
- `UIOpenedEvent` - UIæ‰“å¼€æ—¶è§¦å‘
- `UIClosedEvent` - UIå…³é—­æ—¶è§¦å‘
- `UILayerChangedEvent` - å±‚çº§UIæ•°é‡å˜åŒ–æ—¶è§¦å‘

```csharp
// è®¢é˜…UIæ‰“å¼€äº‹ä»¶
xFrameEventBus.SubscribeTo<UIOpenedEvent>(OnUIOpened);

private void OnUIOpened(ref UIOpenedEvent evt)
{
    Debug.Log($"UIæ‰“å¼€: {evt.UIType.Name}, å±‚çº§: {evt.Layer}");
}
```

#### 2. æ³›å‹UIComponentæ”¯æŒ
æ–°å¢ `UIComponent<TData>` æ³›å‹åŸºç±»ï¼Œæä¾›ç±»å‹å®‰å…¨çš„æ•°æ®è®¾ç½®ï¼š

```csharp
// å®šä¹‰æ•°æ®ç±»å‹
public class ItemData
{
    public int Id;
    public string Name;
}

// ä½¿ç”¨æ³›å‹ç»„ä»¶
public class ItemComponent : UIComponent<ItemData>
{
    protected override void OnSetData(ItemData data)
    {
        // ç±»å‹å®‰å…¨ï¼Œæ— éœ€ç±»å‹è½¬æ¢
        Debug.Log($"ç‰©å“: {data.Name}");
    }
}

// ä½¿ç”¨
itemComponent.SetData(new ItemData { Id = 1, Name = "å‰‘" });
var data = itemComponent.GetData(); // è¿”å›ItemDataç±»å‹
```

#### 3. UIWindowé®ç½©ç³»ç»Ÿå®Œå–„
æ¨¡æ€çª—å£ç°åœ¨è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†é®ç½©ï¼š
- è‡ªåŠ¨åˆ›å»ºå…¨å±é®ç½©
- æ”¯æŒè‡ªå®šä¹‰é®ç½©é¢œè‰²å’Œé€æ˜åº¦
- æ”¯æŒç‚¹å‡»é®ç½©å…³é—­çª—å£
- çª—å£å…³é—­æ—¶è‡ªåŠ¨é”€æ¯é®ç½©

```csharp
public class MyDialog : UIWindow
{
    public override bool IsModal => true;           // æ¨¡æ€çª—å£
    public override bool CloseOnMaskClick => true;  // ç‚¹å‡»é®ç½©å…³é—­
    public override float MaskAlpha => 0.7f;        // é®ç½©é€æ˜åº¦
    public override Color MaskColor => Color.black; // é®ç½©é¢œè‰²
}
```

#### 4. UIåŠ¨ç”»ç³»ç»Ÿ
æ–°å¢ `IUIAnimation` æ¥å£å’Œé¢„å®šä¹‰åŠ¨ç”»ï¼š

```csharp
// ä½¿ç”¨é¢„å®šä¹‰åŠ¨ç”»
UIAnimations.PopIn.Play(rectTransform);
UIAnimations.FadeIn.Play(rectTransform);
UIAnimations.SlideInFromBottom.Play(rectTransform);

// å¼‚æ­¥æ’­æ”¾
await UIAnimations.PopIn.PlayAsync(rectTransform);

// è‡ªå®šä¹‰åŠ¨ç”»
var customAnim = new ScalePopAnimation(duration: 0.5f);
customAnim.Play(rectTransform, () => Debug.Log("åŠ¨ç”»å®Œæˆ"));
```

é¢„å®šä¹‰åŠ¨ç”»ï¼š
- `PopIn` / `PopOut` - ç¼©æ”¾å¼¹å‡º/æ”¶ç¼©
- `FadeIn` / `FadeOut` - æ·¡å…¥/æ·¡å‡º
- `SlideInFromBottom/Top/Left/Right` - æ»‘å…¥åŠ¨ç”»

#### 5. UIç»‘å®šè¾…åŠ©å·¥å…·
æ–°å¢ `UIBinder` å·¥å…·ç±»ï¼Œç®€åŒ–UIç»„ä»¶å¼•ç”¨è·å–ï¼š

```csharp
// æŸ¥æ‰¾ç»„ä»¶
var button = transform.FindComponent<Button>("Panel/Button");
var text = transform.FindComponentRecursive<Text>("Title");

// å¿«æ·ç»‘å®šäº‹ä»¶
transform.BindButton("CloseBtn", () => Close());
transform.BindToggle("SoundToggle", isOn => SetSound(isOn));
transform.BindSlider("VolumeSlider", value => SetVolume(value));

// è®¾ç½®æ–‡æœ¬å’Œå›¾ç‰‡
transform.SetText("Title", "æ¬¢è¿");
transform.SetSprite("Icon", iconSprite);

// è‡ªåŠ¨ç»‘å®šï¼ˆä½¿ç”¨ç‰¹æ€§ï¼‰
public class MyPanel : UIPanel
{
    [UIBind("CloseBtn")] private Button _closeBtn;
    [UIBind("Title")] private TextMeshProUGUI _title;
    
    protected override void OnCreate()
    {
        UIBinder.AutoBind(this, transform);
    }
}
```

### æ–°å¢æ–‡ä»¶
- `IUIAnimation.cs` - UIåŠ¨ç”»æ¥å£å’Œé¢„å®šä¹‰åŠ¨ç”»
- `UIBinder.cs` - UIç»‘å®šè¾…åŠ©å·¥å…·

---

## ğŸ‰ v2.0 - å¤šç•Œé¢åˆ‡æ¢ç³»ç»Ÿ (2024-12-01)

### æ–°åŠŸèƒ½ï¼šTabç³»ç»Ÿ

æ–°å¢äº†å®Œæ•´çš„å¤šç•Œé¢åˆ‡æ¢ç³»ç»Ÿï¼Œæ”¯æŒæ¸¸æˆä¸­ä¸»é¡µçš„å¤šä¸ªé¡µç­¾åˆ‡æ¢åŠŸèƒ½ã€‚

#### æ ¸å¿ƒç»„ä»¶
- âœ… **UITabPage** - æ ‡ç­¾é¡µåŸºç±»ï¼Œæ—¢å¯ç‹¬ç«‹ä½¿ç”¨åˆå¯ä½œä¸ºå®¹å™¨å­é¡µé¢
- âœ… **UITabContainer** - æ ‡ç­¾é¡µå®¹å™¨ï¼Œä½¿ç”¨ç»„åˆæ¨¡å¼ç®¡ç†å¤šä¸ªTabPage
- âœ… **UITabButton** - æ ‡ç­¾æŒ‰é’®ç»„ä»¶ï¼Œç”¨äºåˆ‡æ¢é¡µé¢
- âœ… **UITabContainerBuilder** - æ„å»ºå™¨ï¼Œæä¾›æµå¼APIç®€åŒ–å®¹å™¨æ„å»º

#### æ ¸å¿ƒç‰¹æ€§
- âœ… ç»„åˆæ¨¡å¼ç®¡ç†çˆ¶å­UIç”Ÿå‘½å‘¨æœŸ
- âœ… å­é¡µé¢å¯ç‹¬ç«‹ä½¿ç”¨æˆ–ä½œä¸ºå®¹å™¨ä¸€éƒ¨åˆ†ï¼ˆå¯¹å­é¡µé¢æ— æ„Ÿï¼‰
- âœ… æ”¯æŒç´¢å¼•ã€ç±»å‹ã€åç§°å¤šç§æ–¹å¼åˆ‡æ¢é¡µé¢
- âœ… é¡µé¢åˆ‡æ¢äº‹ä»¶é€šçŸ¥
- âœ… Builderæ¨¡å¼ç®€åŒ–å®¹å™¨æ„å»º

#### æ–°å¢æ–‡ä»¶
- `UITabPage.cs` - æ ‡ç­¾é¡µåŸºç±»
- `UITabContainer.cs` - æ ‡ç­¾é¡µå®¹å™¨
- `UITabButton.cs` - æ ‡ç­¾æŒ‰é’®ç»„ä»¶
- `UITabContainerBuilder.cs` - å®¹å™¨æ„å»ºå™¨
- `TabSystemExample.cs` - å®Œæ•´ç¤ºä¾‹
- `å¤šç•Œé¢åˆ‡æ¢ç³»ç»Ÿæ–‡æ¡£.md` - è¯¦ç»†è®¾è®¡æ–‡æ¡£
- `Tabç³»ç»Ÿå¿«é€Ÿå¼€å§‹.md` - å¿«é€Ÿå…¥é—¨æŒ‡å—

#### ä½¿ç”¨ç¤ºä¾‹
```csharp
// åˆ›å»ºå®¹å™¨
var container = Instantiate(containerPrefab);

// æ·»åŠ é¡µé¢
container.AddPage(Instantiate(homePagePrefab));
container.AddPage(Instantiate(inventoryPagePrefab));
container.AddPage(Instantiate(shopPagePrefab));

// åˆ‡æ¢é¡µé¢
container.SwitchPage(0);                    // é€šè¿‡ç´¢å¼•
container.SwitchPage<InventoryPage>();      // é€šè¿‡ç±»å‹
container.SwitchPage("ShopPage");           // é€šè¿‡åç§°
```

---

## ğŸ”„ v1.0 - ä¾èµ–å…³ç³»è°ƒæ•´

ä¾èµ–å…³ç³»å·²ä» **"å­ç»„ä»¶çŸ¥é“çˆ¶ç»„ä»¶"** è°ƒæ•´ä¸º **"çˆ¶ç»„ä»¶çŸ¥é“å­ç»„ä»¶"**

---

## âœ… è°ƒæ•´å†…å®¹

### 1. æ ¸å¿ƒç±»ä¿®æ”¹

#### UIComponent.cs
- âŒ ç§»é™¤ `ParentView` å±æ€§
- âŒ ç§»é™¤ `SendEventToParent<T>()` æ–¹æ³•
- âŒ ç§»é™¤ `SendMessageToParent<T>()` æ–¹æ³•
- âŒ ç§»é™¤ `IUIMessageReceiver<T>` æ¥å£
- âœ… æ–°å¢ `SendEvent<T>()` æ–¹æ³•ï¼ˆå‘é€å…¨å±€äº‹ä»¶ï¼‰
- âœ… `Initialize()` ä¸å†éœ€è¦ parentView å‚æ•°

#### UIComponentManager.cs
- âŒ ç§»é™¤æ„é€ å‡½æ•°çš„ `parentView` å‚æ•°
- âœ… `AutoRegisterComponents()` éœ€è¦ä¼ å…¥ `rootTransform` å‚æ•°
- âœ… ä¸å†å­˜å‚¨çˆ¶ç»„ä»¶å¼•ç”¨

### 2. ç¤ºä¾‹ä»£ç ä¿®æ”¹

æ‰€æœ‰ç¤ºä¾‹ä»£ç å·²æ›´æ–°ï¼š
- `ItemSlotComponent.cs` - ä½¿ç”¨ `SendEvent()`
- `InventoryPanel.cs` - æŒæœ‰å­ç»„ä»¶å¼•ç”¨åˆ—è¡¨
- `UIComponentUsageExample.cs` - å±•ç¤ºæ­£ç¡®çš„é€šè®¯æ–¹å¼
- `SkillButtonComponent` - ä½¿ç”¨ `SendEvent()`

### 3. æ–‡æ¡£æ›´æ–°

æ‰€æœ‰æ–‡æ¡£å·²æ›´æ–°ï¼š
- `UIç»„ä»¶å¤ç”¨è®¾è®¡.md` - å®Œæ•´è®¾è®¡æ–‡æ¡£
- `ç»„ä»¶ç³»ç»Ÿå¿«é€Ÿå¼€å§‹.md` - å¿«é€Ÿå…¥é—¨æŒ‡å—
- `UIæ¡†æ¶.md` - ä¸»æ–‡æ¡£
- `ä¾èµ–å…³ç³»è¯´æ˜.md` - æ–°å¢ä¾èµ–å…³ç³»è¯¦ç»†è¯´æ˜

---

## ğŸ¯ æ–°çš„ä¾èµ–å…³ç³»

### çˆ¶ç»„ä»¶ â†’ å­ç»„ä»¶

```csharp
public class InventoryPanel : UIPanel
{
    // âœ… çˆ¶ç»„ä»¶æŒæœ‰å­ç»„ä»¶å¼•ç”¨
    private List<ItemSlotComponent> _slots = new List<ItemSlotComponent>();
    
    protected override void OnCreate()
    {
        // âœ… çˆ¶ç»„ä»¶åˆ›å»ºå’Œç®¡ç†å­ç»„ä»¶
        for (int i = 0; i < 20; i++)
        {
            var slot = Instantiate(slotPrefab);
            ComponentManager.RegisterComponent(slot);
            _slots.Add(slot);  // æŒæœ‰å¼•ç”¨
        }
    }
    
    // âœ… çˆ¶ç»„ä»¶å¯ä»¥ç›´æ¥è°ƒç”¨å­ç»„ä»¶æ–¹æ³•
    public void SelectSlot(int index)
    {
        _slots[index].SetSelected(true);
        _slots[index].Show();
    }
}
```

### å­ç»„ä»¶ â†’ äº‹ä»¶æ€»çº¿

```csharp
public class ItemSlotComponent : UIComponent
{
    // âœ… å­ç»„ä»¶ä¸æŒæœ‰çˆ¶ç»„ä»¶å¼•ç”¨
    // âŒ ä¸å­˜åœ¨ ParentView å±æ€§
    
    private void OnClicked()
    {
        // âœ… å‘é€å…¨å±€äº‹ä»¶ï¼ˆä¸çŸ¥é“è°åœ¨ç›‘å¬ï¼‰
        SendEvent(new ItemClickedEvent { ... });
    }
}
```

### çˆ¶ç»„ä»¶æ¥æ”¶äº‹ä»¶

```csharp
public class InventoryPanel : UIPanel
{
    protected override void OnCreate()
    {
        // âœ… è®¢é˜…å…¨å±€äº‹ä»¶
        xFrameEventBus.SubscribeTo<UIComponentEventWrapper<ItemClickedEvent>>(
            OnItemClicked);
    }
    
    private void OnItemClicked(ref UIComponentEventWrapper<ItemClickedEvent> evt)
    {
        // âœ… é€šè¿‡ComponentIdè¯†åˆ«æ˜¯å“ªä¸ªå­ç»„ä»¶
        var slot = ComponentManager.GetComponent<ItemSlotComponent>(evt.ComponentId);
        
        // âœ… æˆ–è€…ç›´æ¥ä½¿ç”¨SourceComponent
        var slot2 = evt.SourceComponent as ItemSlotComponent;
        
        // âœ… ç›´æ¥è°ƒç”¨å­ç»„ä»¶æ–¹æ³•
        slot.SetSelected(true);
    }
}
```

---

## ğŸŒŸ æ ¸å¿ƒä¼˜åŠ¿

### 1. ç¬¦åˆè®¾è®¡æ¨¡å¼
- âœ… éµå¾ªç»„åˆæ¨¡å¼ï¼ˆComposite Patternï¼‰
- âœ… çˆ¶èŠ‚ç‚¹æŒæœ‰å­èŠ‚ç‚¹å¼•ç”¨
- âœ… å­èŠ‚ç‚¹ä¸æŒæœ‰çˆ¶èŠ‚ç‚¹å¼•ç”¨

### 2. é™ä½è€¦åˆ
- âœ… å­ç»„ä»¶ä¸ä¾èµ–å…·ä½“çš„çˆ¶ç»„ä»¶ç±»å‹
- âœ… å­ç»„ä»¶å¯ä»¥åœ¨ä»»ä½•çˆ¶ç»„ä»¶ä¸­å¤ç”¨
- âœ… å­ç»„ä»¶ä¿æŒç‹¬ç«‹æ€§å’Œçº¯ç²¹æ€§

### 3. æ¸…æ™°çš„æ§åˆ¶æƒ
- âœ… çˆ¶ç»„ä»¶æ‹¥æœ‰æ§åˆ¶æƒ
- âœ… çˆ¶ç»„ä»¶ç®¡ç†å­ç»„ä»¶çš„åˆ›å»ºã€é”€æ¯ã€ç”Ÿå‘½å‘¨æœŸ
- âœ… çˆ¶ç»„ä»¶åè°ƒå¤šä¸ªå­ç»„ä»¶ä¹‹é—´çš„äº¤äº’

### 4. å•å‘æ•°æ®æµ
- âœ… çˆ¶ â†’ å­ï¼šç›´æ¥è°ƒç”¨æ–¹æ³•
- âœ… å­ â†’ çˆ¶ï¼šé€šè¿‡äº‹ä»¶é€šçŸ¥
- âœ… æ•°æ®æµå‘æ¸…æ™°æ˜ç¡®

---

## ğŸ“š è¿ç§»æŒ‡å—

å¦‚æœä½ æœ‰åŸºäºæ—§ç‰ˆæœ¬çš„ä»£ç ï¼Œéœ€è¦åšä»¥ä¸‹è°ƒæ•´ï¼š

### 1. ç§»é™¤å­ç»„ä»¶ä¸­çš„çˆ¶ç»„ä»¶å¼•ç”¨

```csharp
// âŒ æ—§ä»£ç 
public class MyComponent : UIComponent
{
    private void DoSomething()
    {
        if (ParentView is MyPanel panel)
        {
            panel.HandleEvent();
        }
    }
}

// âœ… æ–°ä»£ç 
public class MyComponent : UIComponent
{
    private void DoSomething()
    {
        SendEvent(new MyComponentEvent { ... });
    }
}
```

### 2. ä¿®æ”¹äº‹ä»¶å‘é€æ–¹å¼

```csharp
// âŒ æ—§ä»£ç 
SendEventToParent(new ItemClickedEvent { ... });

// âœ… æ–°ä»£ç 
SendEvent(new ItemClickedEvent { ... });
```

### 3. çˆ¶ç»„ä»¶æŒæœ‰å­ç»„ä»¶å¼•ç”¨

```csharp
// âœ… æ–°ä»£ç ï¼šçˆ¶ç»„ä»¶æŒæœ‰å¼•ç”¨
public class MyPanel : UIPanel
{
    private List<MyComponent> _components = new List<MyComponent>();
    
    protected override void OnCreate()
    {
        for (int i = 0; i < 10; i++)
        {
            var comp = Instantiate(prefab);
            ComponentManager.RegisterComponent(comp);
            _components.Add(comp);  // æŒæœ‰å¼•ç”¨
        }
    }
    
    // å¯ä»¥ç›´æ¥æ“ä½œ
    public void HideAll()
    {
        foreach (var comp in _components)
        {
            comp.Hide();
        }
    }
}
```

---

## ğŸ“– å‚è€ƒæ–‡æ¡£

- **ä¾èµ–å…³ç³»è¯¦è§£**: `ä¾èµ–å…³ç³»è¯´æ˜.md`
- **å®Œæ•´è®¾è®¡æ–‡æ¡£**: `UIç»„ä»¶å¤ç”¨è®¾è®¡.md`
- **å¿«é€Ÿå…¥é—¨**: `ç»„ä»¶ç³»ç»Ÿå¿«é€Ÿå¼€å§‹.md`
- **ç¤ºä¾‹ä»£ç **: `InventoryPanel.cs`, `ItemSlotComponent.cs`

---

## âœ¨ æ€»ç»“

æ–°çš„ä¾èµ–å…³ç³»è®¾è®¡è®©UIç»„ä»¶ç³»ç»Ÿæ›´åŠ ï¼š
- âœ… **å¥å£®** - ç¬¦åˆç»å…¸è®¾è®¡æ¨¡å¼
- âœ… **çµæ´»** - å­ç»„ä»¶é«˜åº¦å¯å¤ç”¨
- âœ… **æ¸…æ™°** - èŒè´£æ˜ç¡®ï¼Œæ•°æ®æµå‘æ˜ç¡®
- âœ… **æ˜“ç»´æŠ¤** - ä½è€¦åˆï¼Œé«˜å†…èš

è¿™æ˜¯æ›´å¥½çš„è®¾è®¡ï¼ğŸ‰
